!function(){var e=angular.module("nn.balanceChanger",[]);e.factory("BalanceChanger",[function(){return{balanceField:"",method:"",type:null,amount:0,params:{object:{type:null,model:{}},subject:{type:null,model:{}}}}}]),e.directive("balanceChangerControl",["BalanceChanger",function(e){return{restrict:"E",require:"ngModel",replace:!0,template:'<div class="balance-changer-control"><button class="btn btn-xs btn-danger" ng-click="openModal($event, \'withdraw\')" title="{{ ::__(\'balanceChanger\', \'type.withdraw\') }}">-</button><span>{{ model[balanceField] | nnCurrency }}</span><button class="btn btn-xs btn-success" ng-click="openModal($event, \'deposit\')" title="{{ ::__(\'balanceChanger\', \'type.deposit\') }}">+</button></div>',link:function(a,n,t,l){a.model=null,a.balanceField=t.field||"balance";var o=e;l.$render=function(){a.model=l.$viewValue},a.openModal=function(e,n){o.method=t.method||"Cashier.Player.Balance.change",o.balanceField=a.balanceField,o.type=n,o.amount=null,o.params=angular.extend({amount:0,object:{type:null,model:{}},subject:{type:null,model:{}}},a.$eval(t.params)),o.params.subject.model=a.model,$("#balance-changer-modal").modal("toggle")}}}}]),e.directive("balanceChangerModal",["BalanceChanger","Remote","Alert",function(e,a,n){return{restrict:"C",link:function(t,l,o){var r=t.balanceChanger=e;t.change=function(){if(r.amount<=0)return void n.Big.Simple.Error("Amount has to be positive and greater than zero.");var e={amount:r.amount},o="";if("Cashier.BankGroup.Transaction.moveMoney"===r.params.method)switch(r.type){case"deposit":e.from=[r.params.object.type,objPath(r.params.object.model,"id")],e.to=[r.params.subject.type,objPath(r.params.subject.model,"id")],o="toBalanceAfter";break;case"withdraw":e.from=[r.params.subject.type,objPath(r.params.subject.model,"id")],e.to=[r.params.object.type,objPath(r.params.object.model,"id")],o="fromBalanceAfter";break;default:n.Big.Simple.Error("Undefined transaction type.")}else n.Big.Simple.Error("Undefined method.");a.call(r.params.method,e).then(function(e){var a=objPath(e,o);void 0===a?n.Big.Simple.Error("Undefined balance field."):safeApply(t,function(){r.params.subject.model[r.balanceField]=a}),l.modal("toggle")}).then(n.Small.Simple.Success,n.Big.Simple.Error)}}}}])}();