"use strict";!function(){angular.module("nn.balanceChanger",["ui.bootstrap"]).run(["$templateCache",function(e){e.put("balance-changer/control.html",'\n\t\t<div class="balance-changer-control">\n\t\t\t<button class="btn btn-xs btn-danger" ng-click="$ctrl.open(\'withdraw\')" ng-if="$ctrl.model.buttons.w" title="{{ ::__(\'balanceChanger\', \'type.withdraw\') }}">-</button>\n\t\t\t<button class="btn btn-xs btn-success" ng-click="$ctrl.open(\'deposit\')" ng-if="$ctrl.model.buttons.d && !$ctrl.model.buttons.w" title="{{ ::__(\'balanceChanger\', \'type.deposit\') }}">+</button>\n\t\t\t<span>{{ $ctrl.model.subject.model[$ctrl.balanceField] | nnCurrency }}</span>\n\t\t\t<button class="btn btn-xs btn-success" ng-click="$ctrl.open(\'deposit\')" ng-if="$ctrl.model.buttons.d && $ctrl.model.buttons.w" title="{{ ::__(\'balanceChanger\', \'type.deposit\') }}">+</button>\n\t\t\t<button class="btn btn-xs" ng-click="$ctrl.open(\'ss\')" ng-if="$ctrl.model.buttons.ss && $root.Auth.cashier.can_move_sweepstakes" title="{{ ::__(\'balanceChanger\', \'type.sweepstakes\') }}">SS</button>\n\t\t</div>')}]).component("balanceChangerControl",{templateUrl:"balance-changer/control.html",bindings:{model:"="},controller:["$scope","$uibModal","Auth","Remote","Alert",function(e,n,t,o,a){var l=this.model;_.defaults(l,{method:"Cashier.BankGroup.Transaction.moveMoney",buttons:{w:1,d:1,ss:0},object:{type:"bankGroup"},ssDirection:"win2bet",bonus:null,balanceType:null}),l.subject.field?l.subject.field.basic?this.balanceField=l.subject.field.basic:this.balanceField=l.subject.field:this.balanceField="balance",l.balanceField=this.balanceField,this.open=function(e){t.agent?l.object.model=t.agent:"playerId"===l.subject.type?l.object.model=l.subject.model.bankGroup:"bankGroup"===l.subject.type&&(l.object.model=l.subject.model.parent),l.type=e,delete l.amount;var o="balanceChangerBasicComponent";"ss"===e?(o="balanceChangerSweepstakesComponent",l.type=l.ssDirection):"bonusBalance"!==l.balanceType&&"wagerCounter"!==l.balanceType||(o="balanceChangerBWComponent"),n.open({component:o,size:"sm",resolve:{model:l}})}}]}).component("balanceChangerBasicComponent",{templateUrl:VIEW_PATH+"/partials/balance-changer/modal-basic.html",bindings:{close:"&",dismiss:"&",resolve:"="},controller:["Remote","Alert",function(e,n){var t=this;_.extend(this,this.resolve);var o=this;o.processing=!1,o.ok=function(){if(_.isUndefined(o.model.amount)||o.model.amount<=0)return n.Big.Simple.Error("Amount has to be positive and greater than zero.");var t={amount:o.model.amount},a=null;switch(o.model.type){case"deposit":t.from=[o.model.object.type,objPath(o.model.object.model,"id")],t.to=[o.model.subject.type,objPath(o.model.subject.model,"id")],objPath(o.model,"bonus.id")&&(t.withDepositBonusId=o.model.bonus.id),a="toBalanceAfter";break;case"withdraw":t.from=[o.model.subject.type,objPath(o.model.subject.model,"id")],t.to=[o.model.object.type,objPath(o.model.object.model,"id")],a="fromBalanceAfter";break;default:return n.Big.Simple.Error("Undefined transaction type.")}var l=(o.model.subject,o.model.balanceField);o.processing=!0,e.call("Cashier.BankGroup.Transaction.moveMoney",t).then(function(e){var t=objPath(e,a);void 0===t?n.Big.Simple.Error("Undefined balance field."):o.model.subject.model[l]=t,o.close()}).then(n.Small.Simple.Success,n.Big.Simple.Error).finally(function(){o.processing=!1})},o.cancel=function(){o.dismiss()},o.bonusValue=function(){var e=o.model.bonus,t=o.model.amount||0;return null!=e.bonus_sum?parseInt(t*e.bonus_percent/1e4):null!=e.bonus_percent?t*e.bonus_percent/1e4:(n.Big.Simple.Error("Bonus is broken."),0)},o.wagerValue=function(){var e=o.model.bonus,t=o.model.amount||0;return null!=e.bonus_sum?parseInt(t*e.bonus_percent/1e4):null!=e.bonus_percent?parseInt(t*e.bonus_percent/1e4)*e.wager_coefficient/1e4:(n.Big.Simple.Error("Bonus is broken."),0)},o.totalValue=function(){return(o.model.amount||0)+t.bonusValue()}}]}).component("balanceChangerSweepstakesComponent",{templateUrl:VIEW_PATH+"/partials/balance-changer/modal-sweepstakes.html",bindings:{close:"&",dismiss:"&",resolve:"="},controller:["Remote","Alert",function(e,n){_.extend(this,this.resolve);var t=this;t.processing=!1,t.ok=function(){if(_.isUndefined(t.model.amount)||t.model.amount<=0)return n.Big.Simple.Error("Amount has to be positive and greater than zero.");var o="bet2win"===t.model.type?-1:1,a={amount:o*t.model.amount,playerId:objPath(t.model.subject.model,"id")},l=t.model.subject;t.processing=!0,e.call("Cashier.Player.Balance.sweepstakesWin2Bet",a).then(function(e){l.field.ss?_.each(l.field.ss,function(n){l.model[n]=objPath(e,n)}):void 0!==l.model.balanceBet&&void 0!==l.model.balanceWin?(l.model.balanceBet=objPath(e,"balanceBet"),l.model.balanceWin=objPath(e,"balanceWin")):n.Big.Simple.Error("Unknown field. Nothing to update."),t.close()}).then(n.Small.Simple.Success,n.Big.Simple.Error).finally(function(){t.processing=!1})},t.cancel=function(){t.dismiss()}}]}).component("balanceChangerBWComponent",{templateUrl:VIEW_PATH+"/partials/balance-changer/modal-bw.html",bindings:{close:"&",dismiss:"&",resolve:"="},controller:["Remote","Alert",function(e,n){_.extend(this,this.resolve);var t=this;t.processing=!1,t.ok=function(){if(_.isUndefined(t.model.amount)||t.model.amount<=0)return n.Big.Simple.Error("Amount has to be positive and greater than zero.");var o={playerId:objPath(t.model.subject.model,"id"),wagerAmount:0,bonusAmount:0,changeBalance:!1},a="deposit"===t.model.type?t.model.amount:-t.model.amount,l=null;switch(t.model.balanceType){case"bonusBalance":o.bonusAmount=a,l="bonusBalanceAfter";break;case"wagerCounter":o.wagerAmount=a,l="wagerCounterAfter";break;default:return n.Big.Simple.Error("Undefined balance type.")}var s=(t.model.subject,t.model.balanceField);t.processing=!0,e.call("Cashier.Player.Bonus.Balance.change",o).then(function(e){var o=objPath(e,l);void 0===o?n.Big.Simple.Error("Undefined balance field."):t.model.subject.model[s]=o,t.close()}).then(n.Small.Simple.Success,n.Big.Simple.Error).finally(function(){t.processing=!1})},t.cancel=function(){t.dismiss()}}]})}();